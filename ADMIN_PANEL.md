# Административная панель FishTrackPro

## Обзор

Административная панель предоставляет полный контроль над приложением FishTrackPro, включая управление пользователями, модерацию контента и обработку жалоб.

## Доступ

- **URL**: `/admin`
- **Требования**: Роль `admin` в системе
- **Авторизация**: JWT токен с правами администратора

## Функциональность

### 1. Панель управления (Dashboard)
- **URL**: `/admin`
- **Описание**: Общая статистика и последняя активность
- **Функции**:
  - Статистика пользователей (всего, активных, заблокированных, новых)
  - Статистика уловов (всего, активных, заблокированных, новых)
  - Статистика точек на карте
  - Статистика жалоб
  - Последняя активность пользователей
  - Последние уловы
  - Последние жалобы

### 2. Управление пользователями
- **URL**: `/admin/users`
- **Описание**: Полное управление пользователями системы
- **Функции**:
  - Просмотр списка всех пользователей
  - Фильтрация по статусу (активные/заблокированные)
  - Фильтрация по роли (пользователи/администраторы)
  - Поиск по имени, username или email
  - Просмотр детальной информации о пользователе
  - Блокировка/разблокировка пользователей
  - Редактирование информации пользователя
  - Удаление пользователей (кроме администраторов)

### 3. Управление уловами
- **URL**: `/admin/catches`
- **Описание**: Модерация уловов пользователей
- **Функции**:
  - Просмотр всех уловов
  - Фильтрация по статусу (активные/заблокированные/отредактированные админом)
  - Фильтрация по типу рыбы
  - Фильтрация по пользователю
  - Поиск по описанию или пользователю
  - Просмотр детальной информации об улове
  - Блокировка/разблокировка уловов
  - Редактирование информации об улове
  - Удаление уловов

### 4. Управление точками на карте
- **URL**: `/admin/points`
- **Описание**: Модерация точек на карте
- **Функции**:
  - Просмотр всех точек
  - Фильтрация по статусу (активные/заблокированные/отредактированные админом)
  - Фильтрация по типу (озеро, река, пруд и т.д.)
  - Фильтрация по публичности
  - Фильтрация по пользователю
  - Поиск по названию или описанию
  - Просмотр детальной информации о точке
  - Блокировка/разблокировка точек
  - Редактирование информации о точке
  - Удаление точек

### 5. Управление жалобами
- **URL**: `/admin/reports`
- **Описание**: Обработка жалоб пользователей
- **Функции**:
  - Просмотр всех жалоб
  - Фильтрация по статусу (ожидают/рассмотрены/решены/отклонены)
  - Фильтрация по причине жалобы
  - Фильтрация по типу контента (улов/точка/пользователь)
  - Поиск по описанию или автору жалобы
  - Просмотр детальной информации о жалобе
  - Рассмотрение жалоб (изменение статуса)
  - Массовое рассмотрение жалоб
  - Добавление заметок администратора
  - Статистика жалоб

## API Endpoints

### Dashboard
- `GET /api/v1/admin/dashboard` - Статистика
- `GET /api/v1/admin/recent-activity` - Последняя активность

### Пользователи
- `GET /api/v1/admin/users` - Список пользователей
- `GET /api/v1/admin/users/{id}` - Детали пользователя
- `PUT /api/v1/admin/users/{id}` - Обновление пользователя
- `POST /api/v1/admin/users/{id}/toggle-block` - Блокировка/разблокировка
- `DELETE /api/v1/admin/users/{id}` - Удаление пользователя

### Уловы
- `GET /api/v1/admin/catches` - Список уловов
- `GET /api/v1/admin/catches/{id}` - Детали улова
- `PUT /api/v1/admin/catches/{id}` - Обновление улова
- `POST /api/v1/admin/catches/{id}/toggle-block` - Блокировка/разблокировка
- `DELETE /api/v1/admin/catches/{id}` - Удаление улова

### Точки
- `GET /api/v1/admin/points` - Список точек
- `GET /api/v1/admin/points/{id}` - Детали точки
- `PUT /api/v1/admin/points/{id}` - Обновление точки
- `POST /api/v1/admin/points/{id}/toggle-block` - Блокировка/разблокировка
- `DELETE /api/v1/admin/points/{id}` - Удаление точки

### Жалобы
- `GET /api/v1/admin/reports` - Список жалоб
- `GET /api/v1/admin/reports/{id}` - Детали жалобы
- `POST /api/v1/admin/reports/{id}/review` - Рассмотрение жалобы
- `POST /api/v1/admin/reports/bulk-review` - Массовое рассмотрение
- `GET /api/v1/admin/reports/statistics` - Статистика жалоб

## Безопасность

### Middleware
- `auth:api` - Проверка авторизации
- `admin` - Проверка прав администратора

### Ограничения
- Администраторы не могут блокировать самих себя
- Администраторы не могут удалять других администраторов
- Все действия логируются с указанием администратора

## База данных

### Новые поля в существующих таблицах

#### users
- `is_blocked` - Заблокирован ли пользователь
- `blocked_at` - Дата блокировки
- `block_reason` - Причина блокировки
- `blocked_by` - ID администратора, который заблокировал

#### catch_records
- `is_blocked` - Заблокирован ли улов
- `blocked_at` - Дата блокировки
- `block_reason` - Причина блокировки
- `blocked_by` - ID администратора, который заблокировал
- `is_edited_by_admin` - Отредактирован ли админом
- `edited_by_admin_at` - Дата редактирования админом
- `edited_by_admin_id` - ID администратора, который редактировал

#### points
- `is_blocked` - Заблокирована ли точка
- `blocked_at` - Дата блокировки
- `block_reason` - Причина блокировки
- `blocked_by` - ID администратора, который заблокировал
- `is_edited_by_admin` - Отредактирована ли админом
- `edited_by_admin_at` - Дата редактирования админом
- `edited_by_admin_id` - ID администратора, который редактировал

### Новая таблица reports
- `id` - ID жалобы
- `reporter_id` - ID пользователя, подавшего жалобу
- `reportable_type` - Тип объекта жалобы (catch_record, point, user)
- `reportable_id` - ID объекта жалобы
- `reason` - Причина жалобы
- `description` - Описание жалобы
- `status` - Статус жалобы (pending, reviewed, resolved, dismissed)
- `reviewed_by` - ID администратора, рассмотревшего жалобу
- `reviewed_at` - Дата рассмотрения
- `admin_notes` - Заметки администратора

## Установка и настройка

### 1. Запуск миграций
```bash
cd backend
php artisan migrate
```

### 2. Создание администратора
```bash
php artisan tinker
```
```php
$user = new App\Models\User();
$user->name = 'Администратор';
$user->username = 'admin';
$user->email = 'admin@fishtrackpro.com';
$user->password = Hash::make('admin123');
$user->role = 'admin';
$user->email_verified_at = now();
$user->save();
```

### 3. Заполнение демо данными
```bash
./seed-demo-data.sh
```

## Использование

### Вход в админку
1. Войдите в систему с учетными данными администратора
2. Перейдите по адресу `/admin`
3. Используйте навигацию для перехода между разделами

### Блокировка пользователя
1. Перейдите в раздел "Пользователи"
2. Найдите нужного пользователя
3. Нажмите кнопку блокировки
4. Укажите причину блокировки
5. Подтвердите действие

### Редактирование улова
1. Перейдите в раздел "Уловы"
2. Найдите нужный улов
3. Нажмите кнопку редактирования
4. Внесите изменения
5. Сохраните изменения

### Обработка жалоб
1. Перейдите в раздел "Жалобы"
2. Выберите жалобу для рассмотрения
3. Изучите детали жалобы
4. Примите решение (рассмотрена/решена/отклонена)
5. Добавьте заметки при необходимости

## Техническая поддержка

При возникновении проблем с административной панелью:
1. Проверьте права доступа пользователя
2. Убедитесь в корректности JWT токена
3. Проверьте логи Laravel
4. Обратитесь к разработчику
