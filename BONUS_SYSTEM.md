# –°–∏—Å—Ç–µ–º–∞ –±–æ–Ω—É—Å–æ–≤ FishTrackPro

–°–∏—Å—Ç–µ–º–∞ –±–æ–Ω—É—Å–æ–≤ –ø–æ–æ—â—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ FishTrackPro, –Ω–∞—á–∏—Å–ª—è—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –≤–∞–ª—é—Ç—É –∑–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.

## ü™ô –†–∞–∑–º–µ—Ä—ã –±–æ–Ω—É—Å–æ–≤

| –î–µ–π—Å—Ç–≤–∏–µ | –†–∞–∑–º–µ—Ä –±–æ–Ω—É—Å–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|---------------|----------|
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∞ | 200 ü™ô | –ó–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥—Ä—É–≥–∞ –≤ —Å–ø–∏—Å–æ–∫ |
| –ó–∞–ø–∏—Å—å —É–ª–æ–≤–∞ | 50 ü™ô | –ó–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—é –Ω–æ–≤–æ–≥–æ —É–ª–æ–≤–∞ |
| –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏ | 100 ü™ô | –ó–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä—ã–±–æ–ª–æ–≤–Ω–æ–π —Ç–æ—á–∫–∏ |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è | 10 ü™ô | –ó–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —É–ª–æ–≤—É |
| –ü–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –ª–∞–π–∫ | 5 ü™ô | –ó–∞ –ª–∞–π–∫ —É–ª–æ–≤–∞ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **BonusTransaction** - –º–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–æ–Ω—É—Å–æ–≤
2. **BonusService** - —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–∞–º–∏
3. **BonusController** - API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–Ω—É—Å–∞–º–∏
4. **–°–æ–±—ã—Ç–∏—è –∏ —Å–ª—É—à–∞—Ç–µ–ª–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

### –°–æ–±—ã—Ç–∏—è

- `FriendAdded` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∞
- `CatchRecorded` - –∑–∞–ø–∏—Å—å —É–ª–æ–≤–∞
- `PointCreated` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–∫–∏
- `CommentAdded` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `LikeGiven` - –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –ª–∞–π–∫
- `BonusAwarded` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞

### –°–ª—É—à–∞—Ç–µ–ª–∏

- `AwardFriendBonus` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ –¥—Ä—É–≥–∞
- `AwardCatchBonus` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ —É–ª–æ–≤
- `AwardPointBonus` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ —Ç–æ—á–∫—É
- `AwardCommentBonus` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- `AwardLikeBonus` - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ –ª–∞–π–∫
- `SendBonusNotification` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `bonus_transactions`

```sql
CREATE TABLE bonus_transactions (
    id BIGINT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    type ENUM('earned', 'spent', 'refund') NOT NULL,
    action VARCHAR(255) NOT NULL,
    amount INTEGER NOT NULL,
    description TEXT NULL,
    metadata JSON NULL,
    related_user_id BIGINT NULL,
    related_catch_id BIGINT NULL,
    related_point_id BIGINT NULL,
    related_comment_id BIGINT NULL,
    related_like_id BIGINT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (related_user_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (related_catch_id) REFERENCES catch_records(id) ON DELETE SET NULL,
    FOREIGN KEY (related_point_id) REFERENCES points(id) ON DELETE SET NULL,
    FOREIGN KEY (related_comment_id) REFERENCES catch_comments(id) ON DELETE SET NULL,
    FOREIGN KEY (related_like_id) REFERENCES catch_likes(id) ON DELETE SET NULL
);
```

### –ü–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users`

- `bonus_balance` - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `last_bonus_earned_at` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–∞

## üîå API Endpoints

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã

```http
GET /api/v1/bonus
```
–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ–Ω—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
GET /api/v1/bonus/transactions
```
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–æ–Ω—É—Å–æ–≤

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `per_page` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20)
- `type` - —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`earned`, `spent`, `all`)
- `action` - –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

```http
GET /api/v1/bonus/amounts
```
–ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã –±–æ–Ω—É—Å–æ–≤ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

```http
GET /api/v1/bonus/statistics
```
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ–Ω—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action` - –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```http
GET /api/v1/bonus/leaderboard
```
–ü–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤ –ø–æ –±–æ–Ω—É—Å–∞–º

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- `period` - –ø–µ—Ä–∏–æ–¥ (`all`, `month`, `week`)

```http
POST /api/v1/bonus/spend
```
–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–æ–Ω—É—Å—ã

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
    "action": "subscription_purchased",
    "amount": 1990,
    "description": "–ü–æ–∫—É–ø–∫–∞ Pro –ø–æ–¥–ø–∏—Å–∫–∏"
}
```

### –ê–¥–º–∏–Ω—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã

```http
GET /api/admin/bonus/global-stats
```
–ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –±–æ–Ω—É—Å–∞–º

```http
POST /api/admin/bonus/award
```
–ù–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—Ä—É—á–Ω—É—é

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
    "user_id": 123,
    "action": "manual_award",
    "amount": 100,
    "description": "–ë–æ–Ω—É—Å –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
}
```

## ü§ñ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ (–æ—Ç 50 ü™ô).

### –®–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```
üéÅ *–ë–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª–µ–Ω!*

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (@ivan_fisher)
–î–µ–π—Å—Ç–≤–∏–µ: –ó–∞–ø–∏—Å—å —É–ª–æ–≤–∞
–ë–æ–Ω—É—Å: +50 ü™ô
–ë–∞–ª–∞–Ω—Å: 1250 ü™ô
–í—Ä–µ–º—è: 2024-01-15 16:45:12
```

### Feature Flag

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±–æ–Ω—É—Å–∞—Ö –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
TELEGRAM_BONUS_NOTIFICATIONS=false
```

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

### Rate Limiting

- **–ö—É–ª–¥–∞—É–Ω**: 5 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º–∏ –∑–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: `BonusService::canPerformAction()`

### –í–∞–ª–∏–¥–∞—Ü–∏—è

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –±–æ–Ω—É—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —Ç—Ä–∞—Ç–µ

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```json
{
    "balance": 1250,
    "statistics": {
        "total_earned": 1500,
        "total_spent": 250,
        "current_balance": 1250,
        "transactions_count": 45,
        "by_action": {
            "friends_added": 2,
            "catches_recorded": 15,
            "points_created": 8,
            "comments_added": 12,
            "likes_given": 8
        },
        "recent_transactions": [...]
    }
}
```

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```json
{
    "total_users": 1234,
    "total_transactions": 5678,
    "total_bonuses_awarded": 125000,
    "total_bonuses_spent": 25000,
    "average_bonus_per_user": 101.3,
    "top_earners": [...],
    "action_statistics": [...]
}
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

### –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ç—Ä–∞—Ç–∏—Ç—å –±–æ–Ω—É—Å—ã –Ω–∞:
- Pro –ø–æ–¥–ø–∏—Å–∫—É: 1990 ü™ô
- Premium –ø–æ–¥–ø–∏—Å–∫—É: 4990 ü™ô
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä —Ç—Ä–∞—Ç—ã –±–æ–Ω—É—Å–æ–≤

```php
$bonusService = app(BonusService::class);

$transaction = $bonusService->spendBonus(
    user: $user,
    action: 'subscription_purchased',
    amount: 1990,
    description: '–ü–æ–∫—É–ø–∫–∞ Pro –ø–æ–¥–ø–∏—Å–∫–∏'
);
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±–æ–Ω—É—Å–∞—Ö
TELEGRAM_BONUS_NOTIFICATIONS=true
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–†–∞–∑–º–µ—Ä—ã –±–æ–Ω—É—Å–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –º–æ–¥–µ–ª–∏ `BonusTransaction`:

```php
const BONUS_FRIEND_ADDED = 200;
const BONUS_CATCH_RECORDED = 50;
const BONUS_POINT_CREATED = 100;
const BONUS_COMMENT_ADDED = 10;
const BONUS_LIKE_GIVEN = 5;
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   php artisan migrate
   ```

2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à —Å–æ–±—ã—Ç–∏–π:
   ```bash
   php artisan event:clear
   php artisan config:clear
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ—á–µ—Ä–µ–¥–∏:
   ```bash
   php artisan queue:restart
   ```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–æ–Ω—É—Å–∞–º–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```php
Log::info('Bonus awarded', [
    'user_id' => $user->id,
    'action' => $action,
    'amount' => $amount,
    'transaction_id' => $transaction->id
]);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–∞

```php
$user = User::factory()->create();
$catch = CatchRecord::factory()->create(['user_id' => $user->id]);

event(new CatchRecorded($catch));

$user->refresh();
$this->assertEquals(50, $user->bonus_balance);
```

### –¢–µ—Å—Ç —Ç—Ä–∞—Ç—ã –±–æ–Ω—É—Å–æ–≤

```php
$user = User::factory()->create(['bonus_balance' => 1000]);

$bonusService = app(BonusService::class);
$transaction = $bonusService->spendBonus($user, 'test', 100);

$user->refresh();
$this->assertEquals(900, $user->bonus_balance);
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ –≤ –¥–µ–Ω—å
- –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ –±–æ–Ω—É—Å–∞–º
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –±–æ–Ω—É—Å–æ–≤ –≤ –ø–æ–¥–ø–∏—Å–∫–∏

### –ê–ª–µ—Ä—Ç—ã

- –ê–Ω–æ–º–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- –û—à–∏–±–∫–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –±–æ–Ω—É—Å–æ–≤
- –ü—Ä–æ–±–ª–µ–º—ã —Å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
